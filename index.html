<html>
<head>
<style>
  #chartdiv {
    width: 100%;
    height: 500px;
  }

  #chartdiv2{
    width: 12%;
    height:500px;
  }
  
  </style>
  
  <!-- Resources -->
  <script src="https://cdn.amcharts.com/lib/4/core.js"></script>
  <script src="https://cdn.amcharts.com/lib/4/charts.js"></script>
  <script src="https://cdn.amcharts.com/lib/4/themes/animated.js"></script>
  <script src="https://www.amcharts.com/lib/4/themes/patterns.js"></script>
  <!-- Chart code -->
  <script>
    function monthlyReqChart(retireAge, deadAge, reqAsset, finAsset, pubPention, perPention, retirePention){
      var ageRange=deadAge-retireAge+1; //연령범위
      var reqAsset=reqAsset;  //월 필요금액
      var monthlyFinAsset=Math.round(finAsset/ageRange/12); //월별로 받을 금액들
      var monthlyPubPention=Math.round(pubPention/ageRange/12);
      var monthlyPerPention=Math.round(perPention/ageRange/12);
      var monthlyRetirePention=Math.round(retirePention/ageRange/12);
      var shortAmount=reqAsset-(monthlyFinAsset+monthlyPubPention+monthlyPerPention+monthlyRetirePention);  //월 부족금액
      
      // 도넛차트 시작
      var chart = am4core.create("chartdiv", am4charts.PieChart);
      chart.logo.disabled = true; //arm차트 로고 숨기기
   //   chart.legend = new am4charts.Legend(); 
   //   chart.legend.position = "right";

      // Let's cut a hole in our Pie chart the size of 40% the radius
      chart.innerRadius = am4core.percent(20);
      chart.item
      // 도넛차트 생성
      var pieSeries2 = chart.series.push(new am4charts.PieSeries());

      // 오른쪽 카테고리 설명
      var legend = new am4charts.Legend();
      legend.parent = chart.chartContainer;
     
     // legend.width = 120;
      legend.align = "right";
     
      legend.data = [{
        "name": "금융자산 : " + monthlyFinAsset,
        "fill":"#008FFB"
      }, {
        "name": "공적연금 : " + monthlyPubPention,
        "fill": "#00E397"
      }, {
        "name": "퇴직연금 : " + monthlyRetirePention,
        "fill": "#FEB019"
      },{
        "name": "개인연금 : " + monthlyPerPention,
        "fill": "#FF4560"
      },{
        "name": "부족금액 : " + shortAmount,
        "fill": "#B3C9ED"
      }];
      legend.position="right";
      
      pieSeries2.dataFields.value = "value";
      pieSeries2.slices.template.propertyFields.fill = "fill";
      pieSeries2.labels.template.fontSize="30";
      pieSeries2.labels.template.propertyFields.disabled = "labelDisabled";  //조각 라벨
      pieSeries2.ticks.template.propertyFields.disabled = "labelDisabled";   //조각 화살표
      // Add data
      pieSeries2.data = [{
        "category": "금융자산",
        "value": monthlyFinAsset,
        "fill":"#008FFB",
        "labelDisabled":true
        }, {
        "category": "공적연금",
        "value": monthlyPubPention,
        "fill":"#00E397",
        "labelDisabled":true
        }, 
        {
        "category": "퇴직연금",
        "value": monthlyRetirePention,
        "fill":"#FEB019",
        "labelDisabled":true
        },
        {
        "category": "개인연금",
        "value": monthlyPerPention,
        "fill":"#FF4560",
        "labelDisabled":true,
        },
      
        {
        "category": "부족금액",
        "value": shortAmount,
        "fill":"#B3C9ED",
        "labelDisabled":true
      }];

      // 부족금액 큰 조각 생성부분
      var pieSeries = chart.series.push(new am4charts.PieSeries());
      pieSeries.dataFields.value = "value";
      pieSeries.slices.template.stroke = am4core.color("#fff");
      pieSeries.slices.template.propertyFields.disabled = "labelDisabled2";
      pieSeries.labels.template.propertyFields.disabled = "labelDisabled";  //큰 조각 라벨
      pieSeries.ticks.template.propertyFields.disabled = "labelDisabled";   //큰 조각 화살표
     // chart.legend.disabled="legendDisabled";
      // chart.legend.disabled="legendDisabled";
      // Add data
      pieSeries.data = [{
        "category": "",
        "value": monthlyFinAsset+monthlyPerPention+monthlyPubPention+monthlyRetirePention,
        "labelDisabled":true,
        "labelDisabled2":true
      
      }, {
        "category": "부족금액",
        "value": shortAmount,
        "labelDisabled" : true
      }];
      
      // 마우스 클릭 이벤트 제어
      var slice = pieSeries.slices.template;    
      slice.states.getKey("hover").properties.scale = 1;
      slice.states.getKey("active").properties.shiftRadius = 0;
      slice = pieSeries2.slices.template;
      slice.states.getKey("hover").properties.scale = 1;
      slice.states.getKey("active").properties.shiftRadius = 0;

      // 파이차트 가운데 합계 라벨
      var label = pieSeries.createChild(am4core.Label);
      label.text =  Math.round((monthlyFinAsset+monthlyPerPention+monthlyPubPention+monthlyRetirePention)/reqAsset*100)+"% 달성";
      label.horizontalCenter = "middle";
      label.verticalCenter = "middle";
      label.fontSize = 40;
      
      pieSeries.adapter.add("innerRadius", function(innerRadius, target){
        return am4core.percent(40);
      })
      
      pieSeries2.adapter.add("innerRadius", function(innerRadius, target){
        return am4core.percent(60);
      })
      
      pieSeries.adapter.add("radius", function(innerRadius, target){
        return am4core.percent(100);
      })
      
      pieSeries2.adapter.add("radius", function(innerRadius, target){
        return am4core.percent(80);
      })

    var chart2 = am4core.create("chartdiv2", am4charts.XYChart);
    chart2.logo.disabled = true; //arm차트 로고 숨기기
    
    
    chart2.data = [
      {
        category: "One",
        value1: finAsset+pubPention+perPention+retirePention,   // 내가 지금까지 모은 금액
        value2: (reqAsset*12*ageRange)-(finAsset+pubPention+perPention+retirePention) // 총필요자산 - 내가 지금까지 모은금액(value1)
      }
    ];
    
    chart2.colors.step = 2;
    chart2.padding(30, 30, 10, 30);
    
    var categoryAxis = chart2.xAxes.push(new am4charts.CategoryAxis());
    categoryAxis.dataFields.category = "category";
    categoryAxis.renderer.grid.template.location = 0;
    
    var valueAxis = chart2.yAxes.push(new am4charts.ValueAxis());
    valueAxis.min = 0;
    valueAxis.max = 100;
    valueAxis.strictMinMax = true;
    valueAxis.calculateTotals = true;
    valueAxis.renderer.minWidth = 50;
    valueAxis.renderer.grid.template.disabled = true;
    valueAxis.renderer.labels.template.disabled = true;
    
    
    var series1 = chart2.series.push(new am4charts.ColumnSeries());   //내가 지금까지 모은 돈
    series1.columns.template.width = am4core.percent(100);
    series1.dataFields.categoryX = "category";
    series1.dataFields.valueY = "value1";
    series1.dataFields.valueYShow = "totalPercent";
    series1.dataItems.template.locations.categoryX = 0.5;
    series1.stacked = true;
    
    var bullet1 = series1.bullets.push(new am4charts.LabelBullet());  //막대그래프 안에 글자
    bullet1.interactionsEnabled = false;
    bullet1.label.text = ((finAsset+pubPention+perPention+retirePention)/100000000).toFixed(1)+"억원";
    bullet1.label.fill = am4core.color("#ffffff");
    bullet1.locationY = 0.5;

    var series2 = chart2.series.push(new am4charts.ColumnSeries()); //부족한 부분
    series2.fillOpacity = 0.6;
    series2.columns.template.width = am4core.percent(100);
    series2.dataFields.categoryX = "category";
    series2.dataFields.valueY = "value2";
    series2.dataFields.valueYShow = "totalPercent";
    series2.fill="#ffffff";
    series2.dataItems.template.locations.categoryX = 0.5;
    series2.stacked = true;
    
    var bullet2 = series2.bullets.push(new am4charts.LabelBullet());  //막대그래프 안에 글자
    bullet2.interactionsEnabled = false;
    bullet2.label.text = (((reqAsset*12*ageRange)-(finAsset+pubPention+perPention+retirePention))/100000000).toFixed(1)+"억원";
    bullet2.locationY = 0.5;
    bullet2.label.fill = am4core.color("#FFBB00");
    // end am4core.ready()
    }

  </script>
  </head>
  <body>
  <!-- HTML -->
  <div><div id="chartdiv"></div><div id="chartdiv2"></div></div>
  <script>monthlyReqChart(55, 90, 2700000, 200000000, 429051000, 130485000, 199140000);</script>
</body>

</html>